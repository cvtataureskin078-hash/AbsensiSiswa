<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Siswa Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        :root { --bg: #f0f2f5; --card: #ffffff; --text: #1e272e; --accent: #4834d4; --green: #10ac84; --red: #ff4757; }
        [data-theme="dark"] { --bg: #0a0a0a; --card: #1e1e1e; --text: #ffffff; --accent: #4d3df2; --green: #14bd91; --red: #ff5252; }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box; transition: 0.3s; }
        
        .main-card { 
            background: var(--card); width: 100%; max-width: 950px; min-height: 580px; 
            display: flex; border-radius: 20px; border: 1px solid rgba(0,0,0,0.1); 
            overflow: hidden; color: var(--text); position: relative; transition: 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .left-panel { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .right-panel { flex: 1.2; padding: 40px; background: rgba(0,0,0,0.02); border-left: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        
        @media (max-width: 768px) {
            .main-card { flex-direction: column; height: auto; min-height: unset; margin: 10px 0; }
            .left-panel, .right-panel { padding: 25px; border-left: none; }
            .right-panel { border-top: 1px solid rgba(0,0,0,0.1); }
        }

        h2 { margin: 0; font-weight: 800; text-transform: uppercase; font-size: 26px; letter-spacing: -1px; }
        .date { font-size: 14px; margin-bottom: 20px; opacity: 0.7; font-weight: 600; }
        
        label { font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 5px; display: block; opacity: 0.6; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 2px solid rgba(0,0,0,0.1); background: var(--card); color: var(--text); box-sizing: border-box; font-family: inherit; font-size: 14px; outline: none; }
        
        button { border: none; border-radius: 10px; cursor: pointer; font-weight: 800; transition: 0.3s; }
        .btn-add { background: var(--accent); color: #fff; padding: 15px; width: 100%; font-size: 16px; margin-bottom: 5px; }
        .btn-csv { background: var(--green); color: white; padding: 12px; width: 100%; margin-top: 15px; }
        .btn-reset { background: var(--red); color: white; padding: 8px; width: 100%; margin-top: 8px; font-size: 11px; opacity: 0.9; }
        
        #list { flex-grow: 1; overflow-y: auto; max-height: 400px; padding-right: 5px; min-height: 100px; }
        .item { background: var(--card); margin-bottom: 10px; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid rgba(0,0,0,0.05); border-left: 5px solid var(--accent); animation: slideIn 0.3s ease; }
        
        .badge { padding: 5px 12px; border-radius: 7px; font-size: 10px; color: #fff; font-weight: 800; text-transform: uppercase; }
        .theme-toggle { position: absolute; top: 20px; right: 20px; background: #1e272e; color: #fff; padding: 8px 15px; font-size: 11px; border-radius: 8px; z-index: 10; }
        [data-theme="dark"] .theme-toggle { background: #f0f2f5; color: #1e272e; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body data-theme="light">

    <button class="theme-toggle" onclick="toggleTheme()" id="tBtn">üåô DARK MODE</button>

    <div class="main-card">
        <div class="left-panel">
            <h2>ABSENSI</h2>
            <div class="date" id="tgl"></div>
            
            <label>Nama Siswa</label>
            <input type="text" id="nama" placeholder="Ketik nama lengkap...">
            
            <label>Nomor Absen</label>
            <input type="number" id="no" placeholder="Contoh: 1">
            
            <label>Status</label>
            <select id="stat">
                <option value="" selected disabled>-- Pilih Status --</option>
                <option value="Hadir">Hadir</option>
                <option value="Izin">Izin</option>
                <option value="Sakit">Sakit</option>
                <option value="Alfa">Alfa</option>
            </select>
            
            <button class="btn-add" onclick="tambah()">TAMBAHKAN KE LIST</button>
        </div>

        <div class="right-panel">
            <h3 style="margin-top:0; font-weight: 800;">Daftar Hadir</h3>
            <div id="list"></div>
            
            <button class="btn-csv" onclick="ekspor()">üìä SIMPAN KE EXCEL (.CSV)</button>
            <button class="btn-reset" onclick="hapusSemua()">üóëÔ∏è KOSONGKAN DAFTAR HADIR</button>
        </div>
    </div>

<script>
    // Load data awal
    let dataAbsen = JSON.parse(localStorage.getItem('data_absen_siswa')) || [];

    function setTgl() {
        const d = new Date();
        const tgl = String(d.getDate()).padStart(2, '0');
        const bln = String(d.getMonth() + 1).padStart(2, '0');
        const thn = d.getFullYear();
        document.getElementById('tgl').innerText = `Hari Ini: ${tgl}/${bln}/${thn}`;
    }

    function toggleTheme() {
        const b = document.body;
        const isL = b.getAttribute('data-theme') === 'light';
        b.setAttribute('data-theme', isL ? 'dark' : 'light');
        document.getElementById('tBtn').innerText = isL ? 'üåô DARK MODE' : '‚òÄÔ∏è LIGHT MODE';
    }

    function tambah() {
        const n = document.getElementById('nama').value;
        const nr = document.getElementById('no').value;
        const s = document.getElementById('stat').value;
        
        if(!n || !nr || !s) {
            alert("Mohon lengkapi Nama, Nomor, dan Pilih Status!");
            return;
        }

        const noFix = String(nr).padStart(2, '0');
        const tglFull = document.getElementById('tgl').innerText.replace('Hari Ini: ', '');
        const waktu = new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});

        dataAbsen.push({ n, noFix, s, jam: `${tglFull} ${waktu}` });
        
        saveToStorage();
        render();
        
        // Reset form input
        document.getElementById('nama').value = '';
        document.getElementById('no').value = '';
        document.getElementById('stat').selectedIndex = 0;
    }

    function saveToStorage() {
        localStorage.setItem('data_absen_siswa', JSON.stringify(dataAbsen));
    }

    function render() {
        const kontainer = document.getElementById('list');
        kontainer.innerHTML = '';
        [...dataAbsen].reverse().forEach(x => {
            const colors = {'Hadir': '#10ac84', 'Izin': '#f1c40f', 'Sakit': '#e67e22', 'Alfa': '#ee5253'};
            const c = colors[x.s] || '#7f8c8d';
            kontainer.innerHTML += `<div class="item">
                <div style="max-width: 70%;"><b>${x.n}</b><br><small>No: ${x.noFix} | ${x.jam}</small></div>
                <span class="badge" style="background:${c}">${x.s}</span>
            </div>`;
        });
    }

    function ekspor() {
        if(dataAbsen.length === 0) return alert("Belum ada data!");
        let csv = "sep=,\nNama,No Absen,Waktu,Status\n";
        dataAbsen.forEach(x => {
            csv += `"${x.n}","'${x.noFix}","${x.jam}","${x.s}"\n`;
        });
        const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Rekap_Absen_${new Date().getTime()}.csv`;
        link.click();
    }

    function hapusSemua() {
        // Langsung hapus total tanpa pop-up tanya-tanya
        dataAbsen = [];
        localStorage.removeItem('data_absen_siswa');
        render();
    }

    // Jalankan pertama kali
    setTgl();
    render();
</script>
</body>
</html>
