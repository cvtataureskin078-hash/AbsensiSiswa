<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduPresent - Absensi</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        html { zoom: 0.9; height: 100%; }
        /* FIX: Pastikan body dan html menutup seluruh layar */
        html, body { min-height: 100%; margin: 0; background-color: #f8fafc !important; font-size: 15px; }
        body { 
            font-family: 'Outfit', sans-serif; 
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px); 
            background-size: 20px 20px; 
            background-attachment: fixed;
            color: #1e3a8a !important; 
        }
        .main-wrapper { display: flex; min-height: 100vh; background: transparent; }
        
        /* FIX: Tambahkan min-height 100vh agar warna putih/abu terang full sampai bawah di HP */
        .content-area { 
            flex: 1; 
            padding: 2rem; 
            background-color: #f8fafc; 
            transition: all 0.3s; 
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
        }
        
        .text-navy { color: #1e3a8a !important; }
        .bg-navy { background-color: #1e3a8a !important; }
        .stat-navy { color: #1e3a8a !important; opacity: 1 !important; font-weight: 800 !important; }
        
        .card-custom { background: white; border-radius: 1.5rem; padding: 1.5rem; box-shadow: 0 10px 25px -5px rgba(30, 58, 138, 0.05); border: none; }
        
        .nav-link { color: #1e3a8a !important; font-size: 15px; font-weight: 500; }
        .nav-link i { color: #1e3a8a !important; } 
        .nav-link.active { background-color: #eff6ff; color: #1e3a8a !important; font-weight: 800; }
        
        #pageTitle { font-size: 30px !important; display: block !important; line-height: 1.2; text-align: center; color: #1e3a8a !important; font-weight: 900; }
        
        .clock-badge { background: white; padding: 12px 25px; border-radius: 9999px; display: inline-flex; align-items: center; gap: 12px; box-shadow: 0 4px 15px rgba(30, 58, 138, 0.05); border: none !important; }
        .clock-badge i { color: #1e3a8a !important; font-size: 20px; } 
        .clock-badge span { font-size: 18px !important; font-weight: 400 !important; color: #1e3a8a !important; } 

        .form-control label.label { color: #1e3a8a !important; font-weight: 800; font-size: 12px; justify-content: center; }
        
        input, select { 
            background-color: #ffffff !important; 
            color: #1e3a8a !important; 
            font-weight: 600; 
            border: 1.5px solid #000000 !important; 
            font-size: 15px; 
            height: 3.2rem !important; 
            text-align: center; 
            text-align-last: center; 
            border-radius: 12px !important; 
        }
        input:focus { border-color: #1e3a8a !important; outline: none; }

        .password-container { position: relative; width: 100%; }
        .eye-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #1e3a8a; font-size: 18px; z-index: 10; }

        .page-content { display: none; }
        .page-content.active { display: block; }

        .report-table thead th, .history-table thead th, .dashboard-table thead th { 
            background-color: #1e3a8a !important; color: #ffffff !important; text-align: center; font-weight: 700; border: 1.5px solid #000000 !important; padding: 12px; text-transform: uppercase; font-size: 12px; 
        }
        
        .report-table tbody td, .history-table tbody td, .dashboard-table tbody td { 
            border: 1.5px solid #000000 !important; padding: 12px; text-align: center; color: #1e3a8a !important; font-size: 14px; 
        }
        .report-table, .history-table, .dashboard-table { border-collapse: collapse !important; width: 100%; border: 1px solid #000000 !important; }
        
        .status-label { display: inline-block; padding: 6px 14px; border-radius: 8px; font-weight: 800; font-size: 11px; text-align: center; min-width: 80px; border: none !important; }
        .label-hadir { background-color: #dcfce7; color: #15803d; }
        .label-izin { background-color: #fef3c7; color: #b45309; }
        .label-sakit { background-color: #fee2e2; color: #b91c1c; }
        .label-alpa { background-color: #f1f5f9; color: #1e293b; }
        
        .student-name-cell { font-weight: 800 !important; font-size: 16px !important; color: #1e3a8a !important; text-transform: uppercase; }
        
        .btn-hapus { background-color: #fff1f2; color: #be123c; padding: 6px 14px; border-radius: 8px; font-weight: 800; font-size: 11px; border: none !important; cursor: pointer; }
        
        .btn-logout-navy { background-color: #1e3a8a !important; color: #ffffff !important; border: none !important; }
        .btn-logout-navy:hover { background-color: #172e6d !important; }

        #login-page, #register-page { display: flex; align-items: center; justify-content: center; height: 100vh; background-color: #f8fafc; }
        .login-card { width: 100%; max-width: 400px; padding: 2.5rem !important; }
        .btn-link-navy { color: #1e3a8a !important; font-size: 12px; font-weight: 800; background: none; border: none; cursor: pointer; text-transform: uppercase; text-decoration: underline; }

        #hamburger-btn { display: none; position: fixed; top: 1.5rem; right: 1.5rem; z-index: 100; background: #1e3a8a; color: white; padding: 10px 14px; border-radius: 12px; cursor: pointer; border: none; box-shadow: 0 4px 12px rgba(30, 58, 138, 0.2); }
        .sidebar-wrapper { width: 18rem; background: white; padding: 1.5rem; box-shadow: 0 4px 20px rgba(0,0,0,0.05); z-index: 50; display: flex; flex-direction: column; transition: transform 0.3s ease; }

        @media (max-width: 1024px) {
            #hamburger-btn { display: block; }
            .sidebar-wrapper { position: fixed; height: 100vh; left: 0; top: 0; transform: translateX(-100%); }
            .sidebar-wrapper.open { transform: translateX(0); }
            .content-area { padding-top: 5rem; }
        }

        /* --- TAMBAHAN BIAR PRINT 1 LEMBAR DI HP --- */
        @media print { 
            @page { size: auto; margin: 5mm; } 
            .no-print { display: none !important; } 
            .content-area { margin: 0 !important; padding: 0 !important; min-height: auto !important; } 
            body { background: white !important; zoom: 1; }
            .card-custom { box-shadow: none !important; border: none !important; padding: 0 !important; }
            .report-table, .history-table, .dashboard-table { 
                width: 100% !important; 
                transform: scale(0.9); /* Mengecilkan tabel saat print agar muat 1 lembar */
                transform-origin: top center;
            }
        }
    </style>
</head>
<body>

<button id="hamburger-btn" class="no-print" onclick="toggleSidebar()">
    <i class="fas fa-bars"></i>
</button>

<div id="login-page">
    <div class="card-custom login-card text-center">
        <div class="flex flex-col items-center mb-8">
            <div class="w-16 h-16 bg-navy rounded-2xl flex items-center justify-center text-white shadow-lg mb-4"><i class="fas fa-user-shield text-2xl"></i></div>
            <h2 class="text-2xl font-black text-navy uppercase tracking-tighter">LOGIN ABSENSI</h2>
            <p class="text-slate-400 text-[10px] font-bold mt-1 uppercase tracking-[0.2em]">Silahkan Masuk</p>
        </div>
        <div class="space-y-5 text-left">
            <div class="form-control">
                <label class="label uppercase font-black text-navy">Username</label>
                <input type="text" id="userInput" placeholder="Masukkan Username" class="input w-full" />
            </div>
            <div class="form-control">
                <label class="label uppercase font-black text-navy">Password</label>
                <div class="password-container">
                    <input type="password" id="passInput" placeholder="Masukkan Password" class="input w-full" />
                    <i class="fas fa-eye eye-icon" onclick="togglePass('passInput', this)"></i>
                </div>
            </div>
            <button onclick="handleLogin()" class="btn btn-block bg-navy hover:bg-blue-900 border-none text-white font-black rounded-xl h-14 mt-4 shadow-lg shadow-blue-900/20">MASUK APLIKASI</button>
            <div class="text-center mt-6 space-y-3">
                <div>
                    <p class="text-[11px] font-bold text-slate-500 uppercase">Belum punya akun?</p>
                    <button onclick="switchAuth('register')" class="btn-link-navy">Buat Akun Baru Disini</button>
                </div>
                <div class="pt-2 border-t border-slate-200">
                    <button onclick="customResetLogin()" class="btn-link-navy text-rose-600">Lupa Username / Password?</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="register-page" style="display: none;">
    <div class="card-custom login-card text-center">
        <div class="flex flex-col items-center mb-8">
            <div class="w-16 h-16 bg-navy rounded-2xl flex items-center justify-center text-white shadow-lg mb-4"><i class="fas fa-user-plus text-2xl"></i></div>
            <h2 class="text-2xl font-black text-navy uppercase tracking-tighter">DAFTAR AKUN</h2>
            <p class="text-slate-400 text-[10px] font-bold mt-1 uppercase tracking-[0.2em]">EduPresent Absensi</p>
        </div>
        <div class="space-y-5 text-left">
            <div class="form-control">
                <label class="label uppercase font-black text-navy">Username Baru</label>
                <input type="text" id="regUser" placeholder="Tentukan Username" class="input w-full" />
            </div>
            <div class="form-control">
                <label class="label uppercase font-black text-navy">Password Baru</label>
                <div class="password-container">
                    <input type="password" id="regPass" placeholder="Tentukan Password" class="input w-full" />
                    <i class="fas fa-eye eye-icon" onclick="togglePass('regPass', this)"></i>
                </div>
            </div>
            <button onclick="handleRegister()" class="btn btn-block bg-navy hover:bg-blue-900 border-none text-white font-black rounded-xl h-14 mt-4 shadow-lg shadow-blue-900/20">DAFTAR SEKARANG</button>
            <div class="text-center mt-6 space-y-2">
                <p class="text-[11px] font-bold text-slate-500 uppercase">Sudah punya akun?</p>
                <button onclick="switchAuth('login')" class="btn-link-navy">Kembali ke Login</button>
            </div>
        </div>
    </div>
</div>

<div id="main-app" class="main-wrapper" style="display: none;">
    <div id="sidebar" class="sidebar-wrapper no-print">
        <div class="flex items-center gap-3 mb-10">
            <div class="w-12 h-12 bg-navy rounded-2xl flex items-center justify-center text-white shadow-lg"><i class="fas fa-graduation-cap"></i></div>
            <h2 class="text-xl font-black text-navy tracking-tighter uppercase">EDUPRESENT</h2>
        </div>

        <nav class="space-y-1.5 flex-1 text-left">
            <p class="text-[10px] font-bold text-slate-400 ml-3 mb-3 uppercase tracking-[0.2em]">Menu Utama</p>
            <button onclick="showPage('dashboard')" id="btn-dashboard" class="nav-link active flex items-center w-full gap-3 p-3.5 rounded-xl transition-all"><i class="fas fa-th-large"></i> Dashboard</button>
            <button onclick="showPage('history')" id="btn-history" class="nav-link flex items-center w-full gap-3 p-3.5 rounded-xl transition-all"><i class="fas fa-list-ul"></i> Riwayat Input</button>
            <p class="text-[10px] font-bold text-slate-400 ml-3 mt-6 mb-3 uppercase tracking-[0.2em]">Laporan</p>
            <button onclick="showPage('weekly')" id="btn-weekly" class="nav-link flex items-center w-full gap-3 p-3.5 rounded-xl transition-all text-left"><i class="fas fa-calendar-week"></i> Rekap Mingguan</button>
            <button onclick="showPage('monthly')" id="btn-monthly" class="nav-link flex items-center w-full gap-3 p-3.5 rounded-xl transition-all text-left"><i class="fas fa-calendar-alt"></i> Rekap Bulanan</button>
            <button onclick="showPage('semester')" id="btn-semester" class="nav-link flex items-center w-full gap-3 p-3.5 rounded-xl transition-all text-left"><i class="fas fa-book"></i> Rekap Semester</button>
        </nav>
        
        <div class="mt-auto pt-5 border-t border-slate-100 mb-6 px-2 space-y-2">
            <button onclick="handleLogout()" class="btn btn-logout-navy btn-block h-12 rounded-xl font-black text-[12px] border-none">
                <i class="fas fa-sign-out-alt mr-2"></i> LOGOUT
            </button>
            <button onclick="resetData()" class="btn btn-reset-new btn bg-rose-600 hover:bg-rose-700 text-white btn-block h-14 rounded-2xl font-black text-[14px] border-none">
                <i class="fas fa-sync-alt text-lg mr-3"></i> RESET DATA
            </button>
        </div>
    </div>

    <div class="content-area">
        <div class="mb-8 flex flex-col items-center">
            <div id="clockContainer" class="no-print">
                <div class="clock-badge">
                    <i class="far fa-clock text-lg"></i> 
                    <div class="flex items-center gap-2">
                        <span id="currentDate">Memuat...</span>
                        <span class="text-navy mx-1">|</span>
                        <span id="digitalClock" class="font-black">00.00.00</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-dashboard" class="page-content active">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8 text-center">
                <div class="card-custom border-t-4 border-navy p-3"><p class="stat-navy uppercase text-[10px]">Total</p><h3 class="text-2xl font-black stat-navy sTotal">0</h3></div>
                <div class="card-custom border-t-4 border-emerald-500 p-3"><p class="stat-navy uppercase text-[10px]">Hadir</p><h3 class="text-2xl font-black stat-navy sHadir">0</h3></div>
                <div class="card-custom border-t-4 border-amber-500 p-3"><p class="stat-navy uppercase text-[10px]">Izin</p><h3 class="text-2xl font-black stat-navy sIzin">0</h3></div>
                <div class="card-custom border-t-4 border-rose-500 p-3"><p class="stat-navy uppercase text-[10px]">Sakit</p><h3 class="text-2xl font-black stat-navy sSakit">0</h3></div>
                <div class="card-custom border-t-4 border-slate-900 p-3 col-span-2 md:col-span-1"><p class="stat-navy uppercase text-[10px]">Alpa</p><h3 class="text-2xl font-black stat-navy sAlpa">0</h3></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1">
                    <div class="card-custom text-center">
                        <h3 class="font-black text-navy mb-6 uppercase text-[12px] tracking-widest text-center"><i class="fas fa-plus-circle"></i> Input Baru</h3>
                        <div class="space-y-4">
                            <div class="form-control text-center"><label class="label font-black text-navy">NAMA LENGKAP</label><input type="text" id="nameInp" placeholder="Masukan Nama Lengkap" class="input w-full border-black" /></div>
                            <div class="form-control text-center"><label class="label font-black text-navy">STATUS</label><select id="statusInp" class="select w-full border-black"><option value="" selected disabled>- Pilih Status -</option><option value="Hadir">HADIR</option><option value="Izin">IZIN</option><option value="Sakit">SAKIT</option><option value="Alpa">ALPA</option></select></div>
                            <button onclick="submitData()" class="btn btn-block h-12 bg-navy text-white font-black rounded-xl border-none">SIMPAN ABSENSI</button>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-2 text-left">
                    <div class="card-custom overflow-x-auto">
                        <h3 class="font-black text-navy mb-6 uppercase text-[12px] tracking-widest text-left">Aktivitas Terbaru Hari Ini</h3>
                        <table class="dashboard-table"><thead><tr><th>Waktu</th><th>Nama Siswa</th><th>Status</th><th class="no-print">Aksi</th></tr></thead><tbody id="recentTable"></tbody></table>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-history" class="page-content">
            <div class="card-custom text-left overflow-x-auto"><table class="history-table"><thead><tr><th class="py-4">Tanggal</th><th>Nama Siswa</th><th>Status</th><th class="no-print">Aksi</th></tr></thead><tbody id="historyTableBody"></tbody></table></div>
        </div>

        <div id="rekapContainer" class="page-content text-left">
            <div class="card-custom">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b-2 border-slate-100 pb-6 text-left gap-4">
                    <div><h3 id="rekapTitle" class="text-2xl font-black text-navy uppercase mb-1 text-center md:text-left">Rekap</h3><p id="rekapDesc" class="text-navy font-normal text-[13px] text-center md:text-left"></p></div>
                    <button onclick="window.print()" class="btn bg-navy text-white hover:bg-blue-900 border-none no-print px-6 rounded-xl font-bold text-[12px]"><i class="fas fa-print mr-2"></i> PRINT LAPORAN</button>
                </div>
                <div class="overflow-x-auto"><table class="report-table"><thead id="rekapTableHeader"></thead><tbody id="rekapTableBody"></tbody></table></div>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('edu_abs_pro_v2026_final_fix_v5')) || [];
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
    function togglePass(id, el) { const i = document.getElementById(id); i.type = i.type === "password" ? "text" : "password"; el.classList.toggle('fa-eye-slash'); }
    function switchAuth(t) { document.getElementById('login-page').style.display = t==='login'?'flex':'none'; document.getElementById('register-page').style.display = t==='register'?'flex':'none'; }

    // --- FUNGSI DAFTAR (FIX SUDAH AKTIF) ---
    function handleRegister() {
        const u = document.getElementById('regUser').value, p = document.getElementById('regPass').value;
        if(!u || !p) return alert("Isi username & password baru!");
        localStorage.setItem('edu_user_acc', JSON.stringify({u: u.trim(), p: p.trim()}));
        alert("Berhasil Daftar! Silakan Login."); switchAuth('login');
    }

    function handleLogin() {
        const acc = JSON.parse(localStorage.getItem('edu_user_acc')) || {u:"admin", p:"123456"};
        const u = document.getElementById('userInput').value, p = document.getElementById('passInput').value;
        if(u === acc.u && p === acc.p) { 
            document.getElementById('login-page').style.display='none'; document.getElementById('main-app').style.display='flex'; 
            sessionStorage.setItem('isLoggedIn', 'true'); renderUI();
        } else { alert("Data Salah!"); }
    }

    function customResetLogin() {
        const u = prompt("User Baru:"), p = prompt("Pass Baru:");
        if(u && p) { localStorage.setItem('edu_user_acc', JSON.stringify({u: u.trim(), p: p.trim()})); alert("Berhasil!"); }
    }

    function updateDateTime() {
        const now = new Date(), days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jum'at", "Sabtu"], months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
        document.getElementById('currentDate').innerText = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
        document.getElementById('digitalClock').innerText = now.getHours().toString().padStart(2,'0')+"."+now.getMinutes().toString().padStart(2,'0')+"."+now.getSeconds().toString().padStart(2,'0');
    }
    setInterval(updateDateTime, 1000); updateDateTime();

    function showPage(p) {
        document.querySelectorAll('.page-content').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(x => x.classList.remove('active'));
        document.getElementById('btn-'+p)?.classList.add('active');
        if(['weekly','monthly','semester'].includes(p)) { document.getElementById('rekapContainer').classList.add('active'); renderRekap(p); }
        else { document.getElementById('page-'+p).classList.add('active'); }
        if(window.innerWidth <= 1024) document.getElementById('sidebar').classList.remove('open');
        renderUI();
    }

    function getStatusLabel(s) {
        if (!s || s === "-") return "-";
        const c = s === "Hadir" ? "label-hadir" : s === "Izin" ? "label-izin" : s === "Sakit" ? "label-sakit" : "label-alpa";
        return `<span class="status-label ${c}">${s.toUpperCase()}</span>`;
    }

    function submitData() {
        const n = document.getElementById('nameInp'), s = document.getElementById('statusInp');
        if(!n.value || !s.value) return alert("Isi Data!");
        const now = new Date(), days = ["Minggu", "Senin", "Selasa", "Rabu", "Kamis", "Jum'at", "Sabtu"], months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
        const dStr = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
        db.push({ id: Date.now(), name: n.value.toUpperCase(), status: s.value, dateKey: `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`, dateStr: dStr, timestamp: Date.now(), day: days[now.getDay()] });
        localStorage.setItem('edu_abs_pro_v2026_final_fix_v5', JSON.stringify(db));
        n.value = ""; s.selectedIndex = 0; renderUI();
    }

    function remove(id) { db = db.filter(x => x.id !== id); localStorage.setItem('edu_abs_pro_v2026_final_fix_v5', JSON.stringify(db)); renderUI(); }
    function handleLogout() { sessionStorage.removeItem('isLoggedIn'); location.reload(); }
    function resetData() { if(confirm("Hapus semua?")) { db = []; localStorage.removeItem('edu_abs_pro_v2026_final_fix_v5'); location.reload(); } }

    function renderUI() {
        const todayKey = `${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`;
        const recentT = document.getElementById('recentTable'), historyT = document.getElementById('historyTableBody');
        recentT.innerHTML = ""; historyT.innerHTML = "";
        let stats = { Hadir: 0, Izin: 0, Sakit: 0, Alpa: 0 };
        db.filter(x => x.dateKey === todayKey).sort((a,b) => a.name.localeCompare(b.name)).forEach(item => {
            recentT.innerHTML += `<tr><td>${item.dateStr}</td><td class="student-name-cell">${item.name}</td><td>${getStatusLabel(item.status)}</td><td class="no-print"><button onclick="remove(${item.id})" class="btn-hapus">HAPUS</button></td></tr>`;
        });
        [...db].reverse().forEach(item => {
            stats[item.status]++;
            historyT.innerHTML += `<tr><td>${item.dateStr}</td><td class="student-name-cell">${item.name}</td><td>${getStatusLabel(item.status)}</td><td class="no-print"><button onclick="remove(${item.id})" class="btn-hapus">HAPUS</button></td></tr>`;
        });
        document.querySelector('.sTotal').innerText = db.length;
        document.querySelector('.sHadir').innerText = stats.Hadir;
        document.querySelector('.sIzin').innerText = stats.Izin;
        document.querySelector('.sSakit').innerText = stats.Sakit;
        document.querySelector('.sAlpa').innerText = stats.Alpa;
    }

    function renderRekap(type) {
        const tbody = document.getElementById('rekapTableBody'), thead = document.getElementById('rekapTableHeader');
        tbody.innerHTML = "";
        const now = new Date(), months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
        const curM = months[now.getMonth()];
        const ta = `T.A. ${(now.getMonth() >= 6) ? now.getFullYear() : now.getFullYear()-1}/${(now.getMonth() >= 6) ? now.getFullYear()+1 : now.getFullYear()}`;

        if (type === 'weekly') {
            document.getElementById('rekapTitle').innerText = "REKAP MINGGUAN";
            document.getElementById('rekapDesc').innerText = `Laporan kehadiran minggu ke - 2 (${ta})`;
            thead.innerHTML = `<tr><th>NO</th><th>NAMA SISWA</th><th>SENIN</th><th>SELASA</th><th>RABU</th><th>KAMIS</th><th>JUM'AT</th><th>SABTU</th></tr>`;
            let summary = {};
            db.forEach(item => {
                if(!summary[item.name]) summary[item.name] = { "Senin": "-", "Selasa": "-", "Rabu": "-", "Kamis": "-", "Jum'at": "-", "Sabtu": "-" };
                if(summary[item.name].hasOwnProperty(item.day)) summary[item.name][item.day] = item.status;
            });
            Object.keys(summary).sort().forEach((name, i) => {
                const s = summary[name];
                tbody.innerHTML += `<tr><td>${i+1}</td><td class="student-name-cell">${name}</td><td>${getStatusLabel(s.Senin)}</td><td>${getStatusLabel(s.Selasa)}</td><td>${getStatusLabel(s.Rabu)}</td><td>${getStatusLabel(s.Kamis)}</td><td>${getStatusLabel(s["Jum'at"])}</td><td>${getStatusLabel(s.Sabtu)}</td></tr>`;
            });
        } else if (type === 'monthly') {
            document.getElementById('rekapTitle').innerText = `REKAP BULAN ${curM.toUpperCase()}`;
            document.getElementById('rekapDesc').innerText = `Laporan bulan ${curM} (${ta})`;
            thead.innerHTML = `<tr><th>NO</th><th>NAMA SISWA</th><th>HADIR</th><th>IZIN</th><th>SAKIT</th><th>ALPA</th><th>TOTAL</th></tr>`;
            renderSummary();
        } else {
            const sem = (now.getMonth() >= 6) ? "1" : "2";
            document.getElementById('rekapTitle').innerText = `REKAP SEMESTER ${sem}`;
            document.getElementById('rekapDesc').innerText = `Laporan semester ${sem} (${ta})`;
            thead.innerHTML = `<tr><th>NO</th><th>NAMA SISWA</th><th>HADIR</th><th>IZIN</th><th>SAKIT</th><th>ALPA</th><th>TOTAL</th></tr>`;
            renderSummary();
        }

        function renderSummary() {
            let summary = {};
            db.forEach(i => {
                if(!summary[i.name]) summary[i.name] = {H:0,I:0,S:0,A:0};
                if(i.status==='Hadir') summary[i.name].H++; else if(i.status==='Izin') summary[i.name].I++; else if(i.status==='Sakit') summary[i.name].S++; else summary[i.name].A++;
            });
            Object.keys(summary).sort().forEach((name, idx) => {
                const s = summary[name];
                tbody.innerHTML += `<tr><td>${idx+1}</td><td class="student-name-cell">${name}</td><td>${s.H}</td><td>${s.I}</td><td>${s.S}</td><td>${s.A}</td><td class="font-black text-navy">${s.H+s.I+s.S+s.A}</td></tr>`;
            });
        }
    }
    if(sessionStorage.getItem('isLoggedIn') === 'true') { document.getElementById('login-page').style.display='none'; document.getElementById('main-app').style.display='flex'; renderUI(); }
</script>
</body>
</html>
