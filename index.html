<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Scan Wajah Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        :root { --bg: #f0f2f5; --card: #ffffff; --text: #1e272e; --accent: #4834d4; --green: #10ac84; --red: #ff4757; }
        [data-theme="dark"] { --bg: #0a0a0a; --card: #1e1e1e; --text: #ffffff; --accent: #4d3df2; --green: #14bd91; --red: #ff5252; }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; box-sizing: border-box; transition: 0.3s; }
        
        .main-card { 
            background: var(--card); width: 100%; max-width: 950px; 
            display: flex; border-radius: 20px; border: 1px solid rgba(0,0,0,0.1); 
            overflow: hidden; color: var(--text); position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .left-panel { flex: 1.2; padding: 30px; display: flex; flex-direction: column; }
        .right-panel { flex: 1; padding: 30px; background: rgba(0,0,0,0.02); border-left: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        
        @media (max-width: 850px) {
            .main-card { flex-direction: column; }
            .right-panel { border-left: none; border-top: 1px solid rgba(0,0,0,0.1); }
        }

        /* Camera Box - Ringan & Cepat */
        #cam-box {
            width: 100%; height: 240px; background: #000; border-radius: 15px; 
            overflow: hidden; position: relative; margin-bottom: 15px; 
            border: 3px solid var(--accent);
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        
        /* Overlay deteksi palsu biar keren */
        .scan-line {
            position: absolute; width: 100%; height: 2px; background: var(--accent);
            box-shadow: 0 0 15px var(--accent); top: 0; animation: scan 3s infinite linear;
            display: none;
        }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        label { font-size: 11px; font-weight: 700; margin-bottom: 5px; display: block; opacity: 0.7; }
        input, select { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #ddd; background: var(--card); color: var(--text); box-sizing: border-box; }
        
        button { border: none; border-radius: 10px; cursor: pointer; font-weight: 800; transition: 0.3s; padding: 15px; }
        .btn-cam { background: #2f3542; color: white; margin-bottom: 10px; }
        .btn-add { background: var(--accent); color: white; font-size: 16px; }
        .btn-csv { background: var(--green); color: white; margin-top: 15px; }
        .btn-reset { background: var(--red); color: white; margin-top: 8px; font-size: 11px; }

        #list { flex-grow: 1; overflow-y: auto; max-height: 300px; margin-top: 10px; }
        .item { background: var(--card); padding: 12px; margin-bottom: 8px; border-radius: 12px; border-left: 5px solid var(--accent); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .badge { padding: 5px 10px; border-radius: 6px; color: #fff; font-size: 10px; font-weight: 800; }
    </style>
</head>
<body>

    <div class="main-card">
        <div class="left-panel">
            <h2 style="margin:0;">FACE SCAN ABSEN</h2>
            <p id="status" style="font-size: 12px; color: var(--green); margin-bottom: 15px; font-weight: 600;">‚óè SISTEM SIAP</p>
            
            <div id="cam-box">
                <div class="scan-line" id="line"></div>
                <video id="video" autoplay muted playsinline></video>
            </div>

            <button class="btn-cam" onclick="startCam()">üì∏ AKTIFKAN KAMERA</button>
            
            <label>NAMA LENGKAP</label>
            <input type="text" id="nama" placeholder="Ketik nama siswa...">
            
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>NO ABSEN</label>
                    <input type="number" id="no" placeholder="01">
                </div>
                <div style="flex: 2;">
                    <label>STATUS</label>
                    <select id="stat">
                        <option value="Hadir">Hadir</option>
                        <option value="Izin">Izin</option>
                        <option value="Sakit">Sakit</option>
                        <option value="Alfa">Alfa</option>
                    </select>
                </div>
            </div>
            
            <button class="btn-add" onclick="tambah()">SIMPAN & ABSEN</button>
        </div>

        <div class="right-panel">
            <h3 style="margin-top:0;">Log Kehadiran</h3>
            <div id="list"></div>
            
            <button class="btn-csv" onclick="ekspor()">üìä DOWNLOAD REKAP (.CSV)</button>
            <button class="btn-reset" onclick="hapusSemua()">üóëÔ∏è KOSONGKAN LIST</button>
        </div>
    </div>

<script>
    var dataAbsen = JSON.parse(localStorage.getItem('absen_v3_data')) || [];

    function startCam() {
        var v = document.getElementById('video');
        var l = document.getElementById('line');
        
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
        .then(function(stream) {
            v.srcObject = stream;
            l.style.display = 'block'; // Munculkan garis scan biar keren
            document.getElementById('status').innerText = "‚óè KAMERA AKTIF";
        })
        .catch(function(err) {
            alert("Kamera tidak bisa dibuka. Pastikan beri izin!");
        });
    }

    function tambah() {
        var n = document.getElementById('nama').value;
        var nr = document.getElementById('no').value;
        var s = document.getElementById('stat').value;

        if(!n || !nr) {
            alert("Nama dan Nomor Absen wajib diisi!");
            return;
        }

        var tgl = new Date();
        var jam = tgl.getHours().toString().padStart(2, '0') + ":" + tgl.getMinutes().toString().padStart(2, '0');
        
        dataAbsen.push({ 
            n: n, 
            no: nr.padStart(2, '0'), 
            s: s, 
            jam: jam 
        });

        localStorage.setItem('absen_v3_data', JSON.stringify(dataAbsen));
        render();

        // Reset Form
        document.getElementById('nama').value = '';
        document.getElementById('no').value = '';
    }

    function render() {
        var kontainer = document.getElementById('list');
        kontainer.innerHTML = '';
        var colors = {'Hadir': '#10ac84', 'Izin': '#f1c40f', 'Sakit': '#e67e22', 'Alfa': '#ee5253'};

        for (var i = dataAbsen.length - 1; i >= 0; i--) {
            var x = dataAbsen[i];
            kontainer.innerHTML += '<div class="item">' +
                '<div><b>' + x.n + '</b><br><small>No: ' + x.no + ' | Pukul ' + x.jam + '</small></div>' +
                '<span class="badge" style="background:' + colors[x.s] + '">' + x.s + '</span>' +
            '</div>';
        }
    }

    function ekspor() {
        if(dataAbsen.length === 0) return alert("Data masih kosong!");
        var csv = "sep=,\nNama Siswa,No Absen,Jam,Status\n";
        dataAbsen.forEach(function(x) {
            csv += '"' + x.n + '","' + x.no + '","' + x.jam + '","' + x.s + '"\n';
        });
        var blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
        var link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "Rekap_Absen_Siswa.csv";
        link.click();
    }

    function hapusSemua() {
        dataAbsen = [];
        localStorage.removeItem('absen_v3_data');
        render();
    }

    window.onload = render;
</script>
</body>
</html>
